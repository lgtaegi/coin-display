<!--
Project: BTC Core Display
Version: 1.21-edgeLine-test
Date: 2026-02-09
Author: lgtaegi

Updates:
- Edge-line energy flow using machine-bg_edgeLines.png
- Removed full-screen flash on price update
- Flicker temporarily disabled during price change
- All layout and center alignment preserved
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BTC Core Display</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root { --toggle-offset-y: 12px; }

* { margin:0; padding:0; box-sizing:border-box; }

html, body {
  width:100%;
  height:100%;
  background:black;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  font-family:monospace;
}

/* ================= MACHINE ================= */
.machine {
  position:relative;
  width:min(92vw, 900px);
  aspect-ratio:1/1;
  background:url("machine-bg.png") center/contain no-repeat;
}

/* ================= EDGE LINE ENERGY ================= */
.edge-energy {
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:2;
  opacity:0;

  background:linear-gradient(
    120deg,
    transparent 0%,
    rgba(0,255,255,0.95) 45%,
    rgba(255,255,255,1) 50%,
    rgba(0,255,255,0.95) 55%,
    transparent 70%
  );
  background-size:200% 200%;

  -webkit-mask-image:url("machine-bg_edgeLines.png");
  -webkit-mask-repeat:no-repeat;
  -webkit-mask-position:center;
  -webkit-mask-size:contain;

  mask-image:url("machine-bg_edgeLines.png");
  mask-repeat:no-repeat;
  mask-position:center;
  mask-size:contain;

  filter:
    drop-shadow(0 0 8px rgba(0,255,255,0.9))
    drop-shadow(0 0 16px rgba(0,255,255,0.6));

  transition:opacity 0.2s linear;
}

.edge-energy.active {
  opacity:1;
  animation:edgeFlow 0.9s linear;
}

@keyframes edgeFlow {
  from { background-position:0% 0%; }
  to   { background-position:200% 200%; }
}

/* ================= TOGGLE ================= */
.toggle {
  position:absolute;
  left:50%;
  top:calc(27% + var(--toggle-offset-y));
  transform:translate(-50%, -50%);
  width:38px;
  height:38px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.05rem;
  color:white;
  cursor:pointer;
  user-select:none;
  z-index:3;

  border:1px solid rgba(180,240,255,0.9);
  background:radial-gradient(
    circle,
    rgba(0,255,255,0.35),
    rgba(0,120,255,0.05)
  );
  box-shadow:
    0 0 18px rgba(0,255,255,1),
    inset 0 0 12px rgba(0,255,255,0.7);
}

/* ================= SCREEN ================= */
.screen {
  position:absolute;
  left:50%;
  top:49%;
  transform:translate(-50%, -44%);
  width:70%;
  height:22%;
  z-index:2;
}

/* ================= PARTICLES ================= */
.particles {
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:1;
}

.particle {
  position:absolute;
  width:3px;
  height:3px;
  border-radius:50%;
  background:rgba(255,255,255,0.8);
  box-shadow:0 0 8px rgba(255,255,255,0.9);
  opacity:0.6;
  animation:floatParticle linear infinite;
}

@keyframes floatParticle {
  from { transform:translate(0,0); opacity:0.3; }
  to   { transform:translate(var(--dx), var(--dy)); opacity:0.8; }
}

/* ================= DISPLAY ================= */
.display {
  position:relative;
  width:100%;
  height:70%;
  overflow:hidden;
}

/* ================= PRICE SCAN LINE ================= */
.scan {
  position:absolute;
  left:18.75%;
  top:50%;
  width:62.5%;
  height:3px;
  transform:translateY(-50%) scaleX(0);
  opacity:0;
  background:linear-gradient(
    to right,
    transparent,
    rgba(255,255,255,0.85),
    rgba(0,255,255,0.95),
    rgba(255,255,255,0.85),
    transparent
  );
  box-shadow:0 0 8px rgba(0,255,255,0.8);
  z-index:3;
}

.scan.active {
  animation:scanFlash 0.18s ease-out;
}

@keyframes scanFlash {
  0%   { transform:translateY(-50%) scaleX(0); opacity:1; }
  50%  { transform:translateY(-50%) scaleX(1); opacity:1; }
  100% { transform:translateY(-50%) scaleX(1); opacity:0; }
}

/* ================= NOISE ================= */
.display::before {
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.05) 0px,
    rgba(255,255,255,0.05) 1px,
    transparent 3px,
    transparent 7px
  );
  opacity:0.3;
  animation:scanline 6s linear infinite;
}

.display::after {
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:rgba(255,255,255,0.03);
  animation:flicker 0.15s infinite;
}

/* flicker OFF during price update */
.no-flicker::after {
  animation:none !important;
  opacity:0.03;
}

@keyframes scanline {
  from { transform:translateY(-20%); }
  to   { transform:translateY(20%); }
}

@keyframes flicker {
  0% { opacity:0.02; }
  50% { opacity:0.05; }
  100% { opacity:0.02; }
}

/* ================= SVG ================= */
svg {
  width:100%;
  height:100%;
  position:relative;
  z-index:4;
}

/* ================= WIREFRAME TEXT ================= */
.wire {
  fill:none;
  stroke:#9ffcff;
  stroke-width:2.2;
  stroke-linecap:round;
  stroke-linejoin:round;
  filter:drop-shadow(0 0 6px rgba(0,255,255,0.7));
}
.wire.alt { stroke-width:1.2; stroke-dasharray:6 4; }
.wire.inner { stroke-width:0.9; stroke-dasharray:2 6; }

.time-mode svg text {
  font-size:100px;
  transform: translateY(-24px);
}

/* ================= GLITCH ================= */
.glitch svg {
  animation:glitch 0.12s steps(2) infinite;
}

@keyframes glitch {
  25% { transform:translate(-3px,1px); }
  50% { transform:translate(3px,-1px); }
}
</style>
</head>

<body>

<div class="machine">

  <div class="edge-energy" id="edgeEnergy"></div>
  <div class="toggle" id="toggle">‚ü≤</div>

  <div class="screen">
    <div class="particles" id="particles"></div>

    <div class="display" id="display">
      <div class="scan" id="scan"></div>

      <svg viewBox="0 0 1000 200" preserveAspectRatio="xMidYMid meet">
        <text x="50%" y="84%" text-anchor="middle" font-size="175" class="wire" id="t1">----</text>
        <text x="50%" y="84%" text-anchor="middle" font-size="175" class="wire alt" id="t2">----</text>
        <text x="50%" y="84%" text-anchor="middle" font-size="175" class="wire inner" id="t3">----</text>
      </svg>
    </div>
  </div>

</div>

<script>
const texts = document.querySelectorAll("svg text");
const display = document.getElementById("display");
const toggle = document.getElementById("toggle");
const particles = document.getElementById("particles");
const scan = document.getElementById("scan");
const edgeEnergy = document.getElementById("edgeEnergy");

const API = "https://api.coinbase.com/v2/prices/spot?currency=USD";
const TZ = "America/Denver";

let mode = "price";
let last = "----";

/* particles */
for (let i = 0; i < 24; i++) {
  const p = document.createElement("div");
  p.className = "particle";
  p.style.left = Math.random() * 100 + "%";
  p.style.top  = Math.random() * 100 + "%";
  p.style.animationDuration = (10 + Math.random() * 10) + "s";
  p.style.setProperty("--dx", (Math.random() * 80 - 40) + "px");
  p.style.setProperty("--dy", (Math.random() * 50 - 25) + "px");
  particles.appendChild(p);
}

function setText(v){
  texts.forEach(t => t.textContent = v);
}

async function updatePrice(){
  try{
    const r = await fetch(API);
    const d = await r.json();
    const next = String(Math.round(d.data.amount));

    if(next !== last && mode === "price"){
      setText("");

      display.classList.add("no-flicker");
      scan.classList.add("active");
      edgeEnergy.classList.add("active");

      setTimeout(() => {
        setText(next);
        scan.classList.remove("active");
        edgeEnergy.classList.remove("active");
        display.classList.remove("no-flicker");
      }, 120);
    }
    last = next;
  } catch {
    setText("ERROR");
  }
}

function updateTime(){
  if(mode !== "time") return;
  const t = new Intl.DateTimeFormat("en-US", {
    timeZone: TZ,
    hour:"2-digit", minute:"2-digit", second:"2-digit",
    hour12:true
  }).format(new Date());
  setText(t);
}

toggle.onclick = () => {
  mode = mode === "price" ? "time" : "price";
  display.classList.toggle("time-mode", mode === "time");
  if(mode === "price") setText(last);
};

(function glitchLoop(){
  display.classList.add("glitch");
  setTimeout(() => display.classList.remove("glitch"), 120);
  setTimeout(glitchLoop, 3000 + Math.random() * 3000);
})();

updatePrice();
setInterval(updatePrice, 12000);
setInterval(updateTime, 1000);
</script>

</body>
</html>
