<!--
coin-display
Version: 0.1
Author: lgtaegi
Update:
- Random meteor (shooting star) background effect
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>coin-display</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
* { margin:0; padding:0; box-sizing:border-box; }

html, body {
  width:100%;
  height:100%;
  background: radial-gradient(circle at center, #02020a, #000);
  overflow:hidden;
  color:#fff;
  font-family:'Orbitron', monospace;
}

/* ===== Starfield ===== */
body::before {
  content:"";
  position:fixed;
  inset:0;
  background-image:
    radial-gradient(1px 1px at 20% 30%, #fff, transparent),
    radial-gradient(1px 1px at 80% 40%, #fff, transparent),
    radial-gradient(1px 1px at 50% 80%, #fff, transparent),
    radial-gradient(1px 1px at 70% 60%, #fff, transparent),
    radial-gradient(1px 1px at 30% 70%, #fff, transparent);
  animation: starDrift 60s linear infinite;
  opacity:0.5;
  z-index:0;
}

@keyframes starDrift {
  from { transform: translateY(0); }
  to   { transform: translateY(120px); }
}

/* ===== Meteor ===== */
.meteor {
  position: fixed;
  width: 120px;
  height: 2px;
  background: linear-gradient(90deg, rgba(255,255,255,0), rgba(0,255,255,1));
  opacity: 0.9;
  transform-origin: left center;
  animation: meteorFly 1.2s ease-out forwards;
  z-index: 1;
}

@keyframes meteorFly {
  from {
    transform: translate(0,0) rotate(var(--angle)) scaleX(0.2);
    opacity: 1;
  }
  to {
    transform: translate(var(--dx), var(--dy)) rotate(var(--angle)) scaleX(1);
    opacity: 0;
  }
}

/* ===== Layout ===== */
body {
  display:flex;
  align-items:center;
  justify-content:center;
}

.container {
  position:relative;
  z-index:2;
  text-align:center;
}

/* ===== Energy Core ===== */
.energy-field {
  position:relative;
  padding:40px 60px;
}

.energy-field::before {
  content:"";
  position:absolute;
  inset:-30px;
  border-radius:50%;
  border:2px solid rgba(0,255,255,0.4);
  filter:blur(8px);
  animation:pulse 4s ease-in-out infinite;
}

@keyframes pulse {
  0%,100% { transform:scale(0.95); opacity:0.5; }
  50%     { transform:scale(1.05); opacity:0.9; }
}

.main {
  font-size:clamp(3rem,10vw,8rem);
  font-weight:700;
  text-shadow:0 0 18px rgba(0,255,255,0.9);
}

/* ===== Price Ghost ===== */
.ghost {
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  font-size:clamp(3rem,10vw,8rem);
  color:rgba(0,255,255,0.6);
  pointer-events:none;
  animation:driftAway 6s ease-out forwards;
}

@keyframes driftAway {
  from {
    transform:translate(-50%,-50%) scale(1);
    opacity:0.6;
  }
  to {
    transform:translate(-50%,-160%) scale(0.3);
    opacity:0;
  }
}

.sub-time {
  margin-top:16px;
  font-size:0.9rem;
  opacity:0.7;
}
</style>
</head>

<body>

<div class="container" id="container">
  <div class="energy-field">
    <div class="main" id="price">--</div>
  </div>
  <div class="sub-time" id="time">--</div>
</div>

<script>
const priceEl = document.getElementById("price");
const container = document.getElementById("container");
const timeEl = document.getElementById("time");

const API_URL = "https://api.coinbase.com/v2/prices/spot?currency=USD";
const TIMEZONE = "America/Denver";

let lastPrice = null;

function getTime() {
  return new Intl.DateTimeFormat("en-US", {
    timeZone: TIMEZONE,
    hour:"2-digit", minute:"2-digit", second:"2-digit",
    hour12:true
  }).format(new Date());
}

function spawnGhost(text) {
  const ghost = document.createElement("div");
  ghost.className = "ghost";
  ghost.textContent = text;
  container.appendChild(ghost);
  setTimeout(() => ghost.remove(), 6000);
}

/* ===== Meteor Spawn ===== */
function spawnMeteor() {
  const meteor = document.createElement("div");
  meteor.className = "meteor";

  const startX = Math.random() * window.innerWidth;
  const startY = Math.random() * window.innerHeight * 0.4;
  const angle = 20 + Math.random() * 40;
  const dx = 300 + Math.random() * 400;
  const dy = 200 + Math.random() * 300;

  meteor.style.left = `${startX}px`;
  meteor.style.top = `${startY}px`;
  meteor.style.setProperty("--angle", `${angle}deg`);
  meteor.style.setProperty("--dx", `${dx}px`);
  meteor.style.setProperty("--dy", `${dy}px`);

  document.body.appendChild(meteor);
  setTimeout(() => meteor.remove(), 1500);

  scheduleNextMeteor();
}

function scheduleNextMeteor() {
  const delay = 5000 + Math.random() * 20000; // 5–25s
  setTimeout(spawnMeteor, delay);
}

async function fetchPrice() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    const newPrice = `$${Math.round(Number(data.data.amount)).toLocaleString()}`;
    if (lastPrice && newPrice !== lastPrice) spawnGhost(lastPrice);
    lastPrice = newPrice;
    priceEl.textContent = newPrice;
  } catch {
    priceEl.textContent = "ERROR";
  }
}

function updateTime() {
  timeEl.textContent = `Salt Lake City · ${getTime()}`;
}

fetchPrice();
updateTime();
scheduleNextMeteor();

setInterval(fetchPrice, 10000);
setInterval(updateTime, 1000);
</script>

</body>
</html>
